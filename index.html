<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>我就是數學課本搭公車捷運用機率的人</title>
  <style>
    :root{font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif}
    body{max-width:900px;margin:36px auto;padding:20px;background:#fafafa;color:#111}
    h1{font-size:1.6rem;margin-bottom:4px}
    p.lead{color:#444;margin-top:4px}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(20,20,40,0.06);padding:18px;margin-top:18px}
    label{display:block;margin:8px 0 6px;font-weight:600}
    select{padding:8px 10px;border-radius:8px;border:1px solid #ddd;width:100%;box-sizing:border-box}
    button{margin-top:12px;padding:10px 14px;border-radius:10px;border:0;background:#0b76ef;color:white;font-weight:600;cursor:pointer}
    button.secondary{background:#6c757d}
    button.small{padding:4px 8px;font-size:0.8rem;border-radius:6px;margin-left:6px}
    pre{background:#f7f7fb;padding:12px;border-radius:8px;overflow:auto}
    .result{font-size:1.2rem;margin-top:12px}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:12px}
    .stat{background:#f8f9fb;padding:12px;border-radius:10px;text-align:center}
    .muted{color:#666;font-size:0.9rem}
    footer{margin-top:18px;color:#666;font-size:0.9rem}
    .last-result{margin-top:12px;padding:10px;background:#eef6ff;border-radius:8px;font-size:1rem;color:#333}
    .history-item{margin-bottom:6px;padding:6px;background:#f9f9f9;border-radius:6px}
  </style>
</head>
<body>
  <h1>我就是數學課本用機率決定搭公車還是捷運的人</h1>
  <p class="lead">馬可夫鏈超級有用＃素養導向</p>

  <div class="card">
    <label for="decide">請輸入「我昨天的回家方式」</label>
    <select id="decide" aria-label="昨天回家方式">
      <option value="公車">公車</option>
      <option value="捷運">捷運</option>
    </select>

    <button id="run">執行推測</button>
    <button id="reset" class="secondary" title="重設統計">重設統計</button>

    <div class="last-result" id="lastResult"></div>
    <div class="result" id="resultArea" aria-live="polite"></div>

    <div class="stats-grid" id="statsGrid" style="margin-top:16px"></div>

    <details style="margin-top:12px">
      <summary>歷史紀錄（最近 20 筆，可單獨刪除）</summary>
      <div id="history" style="max-height:260px;overflow:auto"></div>
    </details>
  </div>

  <footer>備註：<br>如果輸入「公車」：骰子 ≥4 → 顯示「搭公車」，否則「搭捷運」。<br>如果輸入「捷運」：骰子 ≥3 → 顯示「搭捷運」，否則「搭公車」。</footer>

  <script>
    const $ = id => document.getElementById(id);
    const STORAGE_KEY = 'yesterday_commute_stats_v1';

    function loadStats(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {total:0,bus:0,mrt:0,history:[]};
      }catch(e){
        return {total:0,bus:0,mrt:0,history:[]};
      }
    }
    function saveStats(s){ localStorage.setItem(STORAGE_KEY,JSON.stringify(s)); }

    function rollDice(){ return Math.floor(Math.random()*10)+1; }

    function decideResult(decide, dice){
      if(decide === '公車'){
        return dice >= 4 ? '搭公車' : '搭捷運';
      }else if(decide === '捷運'){
        return dice >= 3 ? '搭捷運' : '搭公車';
      }else{
        return '輸入錯誤';
      }
    }

    function renderStats(){
      const s = loadStats();
      $('statsGrid').innerHTML = `
        <div class="stat"><div class="muted">總次數</div><div style="font-weight:700;font-size:1.3rem">${s.total}</div></div>
        <div class="stat"><div class="muted">顯示：搭公車</div><div style="font-weight:700;font-size:1.3rem">${s.bus}</div></div>
        <div class="stat"><div class="muted">顯示：搭捷運</div><div style="font-weight:700;font-size:1.3rem">${s.mrt}</div></div>
      `;

      const hist = s.history.slice().reverse();
      if(hist.length){
        const last = hist[0];
        $('lastResult').textContent = `上次結果 (${last.time})：${last.result}`;
        if(last.result.includes('公車')){
          $('decide').value = '公車';
        }else if(last.result.includes('捷運')){
          $('decide').value = '捷運';
        }
      }else{
        $('lastResult').textContent = '尚無上次結果';
      }

      // render history list with delete buttons
      $('history').innerHTML = hist.length ? hist.map((h,idx)=>{
        const indexInStorage = s.history.length - 1 - idx; // map back to storage index
        return `<div class="history-item">[${h.time}] 決定: ${h.decide} | 骰子:${h.dice} → ${h.result}
          <button class="small" onclick="deleteHistory(${indexInStorage})">刪除</button>
        </div>`;
      }).join('') : '尚無紀錄';
    }

    function deleteHistory(index){
      const s = loadStats();
      if(index>=0 && index < s.history.length){
        s.history.splice(index,1);
        s.total = Math.max(0, s.total-1);
        // 重新計算 bus/mrt
        s.bus = 0; s.mrt = 0;
        s.history.forEach(h=>{
          if(h.result==='搭公車') s.bus++;
          else if(h.result==='搭捷運') s.mrt++;
        });
        saveStats(s);
        renderStats();
      }
    }

    document.addEventListener('DOMContentLoaded',()=>{
      renderStats();

      $('run').addEventListener('click',()=>{
        const decide = $('decide').value;
        const dice = rollDice();

        const result = decideResult(decide, dice);

        $('resultArea').innerHTML = `<strong>骰子 = ${dice}</strong><br><div style="margin-top:8px">結果：<strong>${result}</strong></div>`;

        const s = loadStats();
        s.total += 1;
        if(result === '搭公車') s.bus += 1;
        else if(result === '搭捷運') s.mrt += 1;

        s.history = s.history || [];
        s.history.push({time: new Date().toLocaleString('zh-TW'), decide, dice, result});
        if(s.history.length>200) s.history.shift();

        saveStats(s);
        renderStats();
      });

      $('reset').addEventListener('click',()=>{
        if(confirm('確定要清除所有本地統計與歷史紀錄？')){
          localStorage.removeItem(STORAGE_KEY);
          renderStats();
          $('resultArea').textContent = '';
        }
      });
    });
  </script>
</body>
</html>